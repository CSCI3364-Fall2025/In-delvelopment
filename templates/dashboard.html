{% extends 'base.html' %}

{% block title %}Dashboard - {{ user.role }} | Peer Assessment System{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if messages %}
    <div class="row mt-3">
        <div class="col">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if user.role == 'student' or user.role == 'Student' and new_results %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
        New assessment results have been published! <a href="#" class="alert-link">View Results</a>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}

    <div class="row p-2" id="assessment-status-container">
        <div class="col-auto" id="status-header">
            <h2 style="color: var(--bc-maroon);">Status:</h2>
        </div>
        <div class="row" id="pending_assessments">
            <div class="col-auto">
                {% if user.role == "professor" or user.role == "Professor" %}
                <!-- Eventually implement logic -->
                    <p>You have 16{{ total_incomplete_assignments }} students who still need to complete 'Peer Assessment 3'.</p>
                {% else %}
                    {% if num_uncompleted_assessments == 0 %}
                    <p>You have no pending peer assessments.</p>
                    {% else %}
                    <p>You have {{ num_uncompleted_assessments }} assessment(s) to complete.</p>
                    {% endif %}
                {% endif %}
            </div>
            <div class="col-auto">
                {% if user.profile.role == 'professor' or user.role == "Professor" %} 
                    <a href="#" style="color: var(--bc-gold);">Manage Courses and Teams</a>
                {% else %}
                    <a href="#" style="color: var(--bc-gold);">View All Active Assessments</a>
                {% endif %}
            </div>
        </div>
        <div class="row" id="published_results">
            <div class="col-auto">
                {% if user.role == "professor" or user.role == "Professor" %}
                    <!-- Eventually implement logic -->
                    <p>You have 1 unreturned assessment(s) to grade.</p>
                {% else %}
                    {% if num_assessment_results == 0 %}
                        <p>You have no assessment results to view.</p>
                    {% else %}
                        <p>You have {{ num_assessment_results }} returned assessment(s) to view.</p>
                    {% endif %}
                {% endif %}
            </div>
            <div class="col-auto">
                {% if user.role == "professor" or user.role == "Professor" %}
                    <a href="#" style="color: var(--bc-gold);">Grade And Return Assessments</a>
                {% else %}
                    <a href="{% url 'view_all_published_results' %}" style="color: var(--bc-gold);">View All Published Results</a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row justify-content-center" id="profile_box">
        <div class="w-75 border border-2 rounded p-1" style="border-color: var(--bc-maroon);">
            <div class="row p-1 text-center">
                <h1 style="color: var(--bc-maroon);">User Profile</h1>
            </div>
            <div class="row p-2 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Name:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.real_name }}</h5>
                </div>
            </div>
            <div class="row p-2 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Preferred Name:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.preferred_name }}</h5>
                </div>
            </div>
            <div class="row p-1 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Email:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.email }}</h5>
                </div>
            </div>
            <div class="row p-1 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Role:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.role }}</h5>
                </div>
            </div>
            <hr class="m-3">
            <div class="row p-1 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Active Courses:</h5>
                </div>
                <div class="col-auto mb-0">
                    <!-- Eventually create a courses model, use logic to iterate over courses -->
                    <h5 class="fw-lighter">Software Engineering</h5>
                </div>
            </div>
            <div class="row p-1 text-center justify-content-center">
                <div class="col-auto">
                    <h5>My Teams:</h5>
                </div>
                <div class="col-auto mb-0">
                    <!-- Eventually create a teams model, use logic to iterate over teams -->
                    <h5 class="fw-lighter">Ctrl-Alt-Elite</h5>
                </div>
            </div>
            <div class="row p-1 justify-content-center">
                <div class="col-auto justify-content-center">
                    <a class="btn gold-btn" href="{% url 'edit_profile' user.real_name %}">Edit Profile</a>
                </div>
            </div>
        </div>
    </div>

    <div class="row p-2" id="assessment-summary-container">
        <div class="row pt-1" id="assessments-summary-header">
            <h2 style="color: var(--bc-maroon);">Assessment Overview:</h2>
        </div>
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
            <h3>Active Assessments</h3>
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Course</th>
                        <th>Due Date</th>
                        <th>Due Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assessment in active_assessments %}
                    <tr>
                        <td>{{ assessment.id }}</td>
                        <td><a href="{% url 'view_assessment' assessment.id %}" class="link-secondary"
                                title="{{ assessment.title|default_if_none:'Assignment Title' }}">
                                {{ assessment.title|default_if_none:"Assignment Title" }}
                            </a></td>
                        <td>{{ assessment.course }}</td>
                        <td>{{ assessment.due_date }}</td>
                        <td>{{ assessment.due_time }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
            <h3>Closed Assessments</h3>
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Course</th>
                        <th>Closed Date</th>
                        <th>Closed Time</th>
                        <th>Grade</th>
                        <th>Comments</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assessment in closed_assessments %}
                    <tr>
                        <td>{{ assessment.id }}</td>
                        <td><a href="{% url 'view_comments' assessment.id %}" class="link-secondary"
                                title="{{ assessment.title|default_if_none:'Assignment Title' }}">
                                {{ assessment.title|default_if_none:"Assignment Title" }}
                            </a></td>
                        <td>{{ assessment.course }}</td>
                        <td>{{ assessment.closed_date }}</td>
                        <td>{{ assessment.closed_time }}</td>
                        <td>{{ assessment.grade|default:"N/A" }}</td>
                        <td><a href="{% url 'view_comments' assessment.id %}" class="btn btn-info">View Comments</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
            <h3>Upcoming Assessments</h3>
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Course</th>
                        <th>Open Date</th>
                        <th>Open Time</th>
                    </tr>
                </thead>
                <tbody>
                    {% for assessment in upcoming_assessments %}
                    <tr>
                        <td>{{ assessment.id }}</td>
                        <td>{{ assessment.title|default_if_none:"Assignment Title" }}</td>
                        <td>{{ assessment.course }}</td>
                        <td>{{ assessment.open_date }}</td>
                        <td>{{ assessment.open_time }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <hr>
    <div class="row p-2" id="quick_links">
        <div class="row">
            <div class="col-auto">
                <h5 style="color: var (--bc-maroon);">Quick Links:</h5>
            </div>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">View My Courses</a>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">View My Teams</a>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">Contact{% if user.role == "Student" %} A Professor{% else %} Students{% endif %}</a>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">Report an Issue</a>
        </div>
    </div>
</div>
{% endblock %}