{% extends 'base.html' %}

{% block title %}Dashboard - {{ user.role }} | Peer Assessment System{% endblock %}

{% block content %}
<div class="container-fluid">
    {% if messages %}
    <div class="row mt-3">
        <div class="col">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="row text-center p-4">
        <h1>Welcome {{ user.name }} - {{ user.role }}</h1>
    </div>
    <div class="row justify-content-center">
        <div class="w-75 border border-2 rounded p-1" style="border-color: var(--bc-maroon);">
            <div class="row p-1 text-center">
                <h1 style="color: var(--bc-maroon);">User Profile</h1>
            </div>
            <div class="row p-2 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Name:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.name }}</h5>
                </div>
            </div>
            <div class="row p-1 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Email:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.email }}</h5>
                </div>
            </div>
            <div class="row p-1 text-center justify-content-center">
                <div class="col-auto">
                    <h5>Role:</h5>
                </div>
                <div class="col-auto mb-0">
                    <h5 class="fw-lighter">{{ user.role }}</h5>
                </div>
            </div>
            <div class="row p-1 justify-content-center">
                <div class="col">
                    <a class="btn gold-btn" href="#">Edit Profile</a>
                </div>
            </div>
        </div>
    </div>

    <div class="row p-2" id="assessment-summary-container">
        <div class="row pt-1" id="assessments-summary-header">
            <h2 style="color: var(--bc-maroon);">Assessment Overview:</h2>
        </div>
        <div class="row pt-2" id="active-assessments-container">
            <div class="col-auto">
                <span class="badge rounded-pill" style="background-color: var(--bc-gold);" id="num-open-assessments">{{
                    active_assessments|length }}</span>
            </div>
            <div class="col-auto">
                <h5>Active Assessments:</h5>
            </div>
            {% for assessment in active_assessments %}
            <div class="col-auto">
                <a href="#" class="link" style="color: var(--bc-gold);">{{ assessment.title }} ({{ assessment.course
                    }}), Due {{ assessment.due_date }}</a>
            </div>
            {% endfor %}
        </div>
        <div class="row pt-4" id="closed-assessments-container">
            <div class="col-auto">
                <span class="badge rounded-pill" style="background-color: var(--bc-gold);"
                    id="num-closed-assessments">{{ closed_assessments|length }}</span>
            </div>
            <div class="col-auto">
                <h5>Closed Assessments:</h5>
            </div>
            {% for assessment in closed_assessments %}
            <div class="col-auto">
                <a href="#" class="link-secondary">{{ assessment.title }} ({{ assessment.course }}), Closed {{
                    assessment.closed_date }}</a>
            </div>
            {% endfor %}
        </div>
        <div class="row pt-4" id="upcoming-assessments-container">
            <div class="col-auto">
                <span class="badge rounded-pill" style="background-color: var(--bc-gold);"
                    id="num-upcoming-assessments">{{ upcoming_assessments|length }}</span>
            </div>
            <div class="col-auto">
                <h5>Upcoming Assessments:</h5>
            </div>
            {% for assessment in upcoming_assessments %}
            <div class="col-auto">
                <p class="text-body-secondary">{{ assessment.title }} ({{ assessment.course }}), Opens {{
                    assessment.open_date }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    <div class="row p-2" id="assessment-status-container">
        <div class="col-auto" id="status-header">
            <h2 style="color: var(--bc-maroon);">Status:</h2>
        </div>
        <div class="row" id="pending_assessments">
            <div class="col-auto">
                {% if num_uncompleted_assessments == 0 %}
                <p>You have no pending peer assessments.</p>
                {% else %}
                <p>You have {{ num_uncompleted_assessments }} assessment(s) to complete.</p>
                {% endif %}
            </div>
            <div class="col-auto">
                <a href="#" style="color: var(--bc-gold);">View All Active Assessments</a>
            </div>
        </div>
        <div class="row" id="published_results">
            <div class="col-auto">
                {% if num_assessment_results == 0 %}
                <p>You have no assessment results to view.</p>
                {% else %}
                <p>You have {{ num_assessment_results }} returned assessment(s) to view.</p>
                {% endif %}
            </div>
            <div class="col-auto">
                <a href="#" style="color: var(--bc-gold);">View All Published Results</a>
            </div>
        </div>
    </div>
    <hr>
    <div class="row p-2" id="quick_links">
        <div class="row">
            <div class="col-auto">
                <h5 style="color: var(--bc-maroon);">Quick Links:</h5>
            </div>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">View My Courses</a>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">View My Teams</a>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">Contact A Professor</a>
        </div>
        <div class="col-auto">
            <a href="#" style="color: var(--bc-gold);">Report an Issue</a>
        </div>
    </div>
</div>

{% if user.role == 'student' %}
<div id="studentView" class="container">
    <h2>Peer Assessment</h2>
    <label for="student">Select Team Member:</label>
    <select id="student" name="student">
        <option value="julian_castro">Julian Castro</option>
        <option value="student1">Alice</option>
        <option value="student2">Bob</option>
        <option value="student3">Charlie</option>
        <option value="self">Self</option>
    </select>
    <label for="contribution">Rate Contribution:</label>
    <select id="contribution" name="contribution">
        <option value="excellent">Excellent</option>
        <option value="good">Good</option>
        <option value="average">Average</option>
        <option value="poor">Poor</option>
    </select>
    <label for="teamwork">Rate Teamwork:</label>
    <select id="teamwork" name="teamwork">
        <option value="excellent">Excellent</option>
        <option value="good">Good</option>
        <option value="average">Average</option>
        <option value="poor">Poor</option>
    </select>
    <label for="communication">Rate Communication:</label>
    <select id="communication" name="communication">
        <option value="excellent">Excellent</option>
        <option value="good">Good</option>
        <option value="average">Average</option>
        <option value="poor">Poor</option>
    </select>
    <label for="feedback">Additional Comments:</label>
    <textarea id="feedback" name="feedback"></textarea>
    <button type="submit">Submit Assessment</button>
    <button onclick="viewGrades()">View Grades</button>
    <div id="gradeResults"></div>
</div>
{% elif user.role == 'professor' %}
<div id="professorView" class="container">
    <h2>Professor Dashboard</h2>
    <label for="team">Select Team:</label>
    <select id="team" name="team">
        <option value="team1">Team Alpha</option>
        <option value="team2">Team Beta</option>
        <option value="team3">Team Gamma</option>
    </select>
    <label for="studentProf">Select Student:</label>
    <select id="studentProf" name="studentProf">
        <option value="julian_castro">Julian Castro</option>
        <option value="student1">Alice</option>
        <option value="student2">Bob</option>
    </select>
    <button type="button" onclick="viewAssessmentResults()">View Assessment Results</button>
    <div id="assessmentResults"></div>
</div>
{% endif %}
{% endblock %}